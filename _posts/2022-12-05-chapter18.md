layout single title: "Chapter 18"

18장



## Graph Neural Networks for Capturing Dependencies in Graph Structured Data



### Introduction to graph data

그래프는 데이터에서 관계를 설명하고 캡처하는 특정 방식을 나타낸다.

- 비선형적이고 추상적인 특정 유형의 데이터 구조
- 추상적인 객체이므로 그래프가 작동할 수 있도록 구체적인 표현을 정의해야 함
- 서로 다른 표현이 필요한 특정 속성을 갖도록 정의할 수 있음

 다음 그림에서는 일반적인 유형의 그래프가 요약되어 있다.



![그림](/image/image-20221204153232619.png)



### Undirected graphs

무방향 그래프는 노드의 순서와 연결이 중요하지 않은 가장자리를 통해 연결된 노드로 구성된다. 



다음 그림은 무방향 그래프의 두 가지 일반적인 예이다.



![그림](/image/image-20221204153303966.png)

### Directed graphs

방향 지정 그래프는  방향 지정된 가장자리를 통해 노드를 연결한다. 

방향 그래프의 예로는 인용 네트워크이며, 이는 다음과 그림과 같이 표현이 가능하다.



![그림](/image/image-20221204153403240.png)

### Labeled graphs

분자는 레이블이 지정된 그래프로 표현될 수 있는 데이터의 예이다.



### Representing molecules as graphs

화학적 개요로서, 분자는 화학 결합에 의해 함께 결합된 원자들의 그룹으로 생각될 수 있다.
분자를 노드 레이블 행렬을 사용하여 무방향 그래프로 나타낼 수 있으며, 여기서 각 행은 관련 노드의 원자 유형에 대한 단일 핫 인코딩이다. 또한, 각 행이 연관된 에지의 결합 유형을 핫으로 인코딩하는 에지 레이블 행렬이 있다. 

표현의 단순화를위 해 수소 원자의 위치를 암시적으로 만든다. 앞서 본 카페인 분자를 고려하여 암시적 수소 원자를 사용한 그래프 표현의 예는 다음과 같다.



![그림](/image/image-20221204153542677.png)



### Implementing a basic graph convolution

CNN에서 설명한 바와 같이 필터는 특정 기능의 검출기로 볼 수 있다. 

이미지 데이터에 접근 방식은 다음과 같은 이유로 적합하다.

1. 시프트 불변성: 이미지의 기능은 위치에 관계없이 계속 인식할 수 있다. 
   - 고양이는 왼쪽 위, 오른쪽 아래, 이미지의 다른 부분에 있든 상관없이 고양이로 인식될 수 있다.
2. 지역: 주변 픽셀은 밀접하게 관련되어 있다.
3. 계층: 이미지의 더 큰 부분은 종종 연관된 더 작은 부분의 조합으로 분해될 수 있다. 
   - 고양이는 머리와 다리를 가지고 있다; 머리는 눈과 코를 가지고 있다; 눈은 동공과 홍채를 가지고 있다.


컨볼루션이 이미지 처리에 적합한 또 다른 이유는 훈련 가능한 매개 변수의 수가 입력의 차원에 의존하지 않기 때문이다.

이미지와 마찬가지로 그래프도 컨볼루션 접근 방식을 정당화하는 자연스러운 선행 조건을 가지고 있다. 

- 이미지와 그래프의 두 가지 데이터는 모두 이전의 로컬리티를 공유한다. 
- 지역성을 정의하는 방법은 다르다. 
  - 이미지에서 선행은 2D 공간의 국소성에 대한 것임
  - 그래프의 경우 구조적 국소성에 대한 것임

따라서, 그래프의 경우 하나의 에지에서 떨어진 노드가 다섯 에지에서 떨어진 노드보다 관련될 가능성이 더 높다는 것을 의미한다.
그래프 데이터의 엄격한 선행은 순열 불변성이며, 이는 노드의 순서가 출력에 영향을 미치지 않는다는 것을 의미한다. 이것은 다음 그림과 같이 표현할 수 있다. 



![그림](/image/image-20221204153648310.png)

위의 그래프 노드의 순서를 변경해도 그래프의 구조는 변경되지 않는다.

그림과 같이 동일한 그래프를 여러 인접 행렬로 나타낼 수 있으므로, 결과적으로 그래프 컨볼루션은 순열 불변이어야 한다.
컨볼루션 접근법은 크기가 다른 그래프에 대한 고정 매개 변수 세트로 작동할 수 있기 때문에 그래프에도 적합하다. 이 속성은 거의 틀림없이 이미지보다 그래프에 훨씬 더 중요하다.



### Implementing a GNN in PyTorch from scratch



![그림](/image/image-20221204153733712.png)

위의 그림은 nxn 인접 행렬 A 및 nxf(in) 노드 피쳐 행렬 X에 의해 지정된 노드 레이블이 있는 무방향 그래프를 나타낸다. 여기서 유일한 특징은 각 노드의 색상(녹색(G), 파란색(B) 또는 주황색(O)의 원핫 표현이다.



![그림](/image/image-20221204162629108.png)







위의 그림에 설명된 그래프 컨볼루션의 설계는 그래프 데이터에 대한 이전의 설계에 적합하지만 행렬 형태의 이웃에 대한 합을 구현하는 방법은 명확하지 않을 수 있다. 여기서 인접 행렬 A를 활용하며, 이 컨볼루션의 행렬 형태는 XW(1) + AXW(2)가 된다. 

- 1과 0으로 구성된 인접 행렬은 노드를 선택하고 원하는 합계를 계산하는 마스크 역할함



다음 그림은 메시지 전달 아이디어를 시각화하고 컨볼루션을 요약한 그림이다.



![그림](/image/image-20221204162647562.png)



각 계층이 수행하는 작업의 시각화와 함께 네트워크의 구조가 다음 그림에 요약되어 있다.



![그림](/image/image-20221204162758845.png)



### Adding a global pooling layer to deal with varying graph sizes

 그래프 크기가 크게 다를 수 있는 경우 패딩은 비효율적이다. 이에 대한 해결책으로는 각 배치를 단일 그래프로 처리하는 것이다. 여기서 배치의 각 그래프는 나머지 그래프와 연결이 끊어진 부분 그래프이다. 이것은 다음 그림과 같이 나타난다.

![그림](/image/image-20221204162837494.png)



### Pooling

레이어 풀링에 의해 제공되는 다운샘플링은 CNN 아키텍처에서 유용했지만, GNN에서 다운샘플링의 이점은 명확하게 실현되지 않는다.
이미지 데이터에 대한 풀링 레이어는 

- 그래프에 없는 공간적 위치를 사용함
- 그래프의 노드 클러스터링이 제공되는 경우 그래프 풀링 계층이 노드를 풀링하는 방법을 정의할 수 있음 
- 최적의 클러스터링을 정의하는 방법은 불분명함
-  다양한 컨텍스트에 대해 다양한 클러스터링 접근 방식이 선호될 수 있음
- 클러스터링이 결정된 후에도 노드가 다운샘플링된 경우 나머지 노드를 연결하는 방법이 불분명함

CNN과 마찬가지로 GNN에 적용할 수 있는 평균 및 최대 풀링 레이어가 있으며, 다음 그림과 같이 노드 클러스터링이 주어지면 각 클러스터는 새 그래프의 노드가 된다.



![그림](/image/image-20221204163032809.png)
